name: Import CSV to Supabase

# Dispara quando houver push no arquivo CSV
on:
  push:
    paths:
      - 'coleta-trends-para.csv'
  workflow_dispatch:  # Permite execuÃ§Ã£o manual

jobs:
  import-data:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout do repositÃ³rio
      - name: ğŸ“‚ Checkout repository
        uses: actions/checkout@v4
      
      # 2. Configurar Python 3.11
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      # 3. Instalar dependÃªncias Python (SEM CACHE)
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip --no-cache-dir
          pip install supabase==2.3.0 --no-cache-dir --force-reinstall
      
      # 4. Executar script de importaÃ§Ã£o
      - name: ğŸš€ Run import script
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          CSV_PATH: coleta-trends-para.csv
        run: |
          python import_csv_amazonia.py
      
      # 5. Log de sucesso
      - name: âœ… Import completed
        if: success()
        run: |
          echo "âœ… ImportaÃ§Ã£o concluÃ­da com sucesso!"
          echo "ğŸ“Š Dados disponÃ­veis no Supabase"
      
      # 6. Log de erro
      - name: âŒ Import failed
        if: failure()
        run: |
          echo "âŒ ImportaÃ§Ã£o falhou!"
          echo "ğŸ’¡ Verifique os logs acima para detalhes"
