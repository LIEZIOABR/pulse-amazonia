name: Import CSV to Supabase

# Dispara quando houver push nos arquivos CSV
on:
  push:
    paths:
      - 'coleta-trends-para.csv'
      - 'coleta-concorrentes-nacionais.csv'
  workflow_dispatch:  # Permite execuÃ§Ã£o manual

jobs:
  import-data:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout do repositÃ³rio
      - name: ğŸ“‚ Checkout repository
        uses: actions/checkout@v4
      
      # 2. Configurar Python 3.11
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      # 3. Instalar dependÃªncias Python (VERSÃƒO MAIS RECENTE)
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip --no-cache-dir
          pip install supabase --no-cache-dir --force-reinstall
      
      # 4. Executar script de importaÃ§Ã£o - DESTINOS PARÃ
      - name: ğŸŒ´ Import PA destinations
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          CSV_PATH: coleta-trends-para.csv
        run: |
          python import_csv_amazonia.py
      
      # 5. Executar script de importaÃ§Ã£o - CONCORRENTES NACIONAIS
      - name: ğŸŒ Import National Competitors
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          CSV_PATH: coleta-concorrentes-nacionais.csv
        run: |
          python import_csv_concorrentes.py
      
      # 6. Log de sucesso
      - name: âœ… Import completed
        if: success()
        run: |
          echo "âœ… ImportaÃ§Ã£o concluÃ­da com sucesso!"
          echo "ğŸ“Š Dados PA + Concorrentes disponÃ­veis no Supabase"
          echo "ğŸŒ´ Tabela: pulse_amazonia (15 destinos)"
          echo "ğŸŒ Tabela: concorrentes_nacionais (8 destinos)"
      
      # 7. Log de erro
      - name: âŒ Import failed
        if: failure()
        run: |
          echo "âŒ ImportaÃ§Ã£o falhou!"
          echo "ğŸ’¡ Verifique os logs acima para detalhes"
          echo "ğŸ” Verifique qual script falhou (PA ou Concorrentes)"
