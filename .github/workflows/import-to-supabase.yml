name: Pulse AmazÃ´nia â€“ Coleta e ImportaÃ§Ã£o AutomÃ¡tica

on:
  workflow_dispatch:
  schedule:
    - cron: '0 9 * * *'

jobs:
  coleta-import:
    runs-on: ubuntu-latest

    steps:

      - name: ğŸ“‚ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytrends pandas requests supabase

      - name: ğŸ”„ Run automatic collection
        run: |
          python coleta_automatica_trends.py

      - name: ğŸ’¾ Commit updated CSV files
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git pull --rebase
          git add coleta-trends-para.csv
          git add coleta-concorrentes-nacionais.csv
          git commit -m "AtualizaÃ§Ã£o automÃ¡tica de coleta diÃ¡ria" || echo "Sem alteraÃ§Ãµes"
          git push

      - name: ğŸŒ´ Import PA destinations
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          CSV_PATH: coleta-trends-para.csv
        run: |
          python import_csv_amazonia.py

      - name: ğŸŒ Import National Competitors
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          CSV_PATH: coleta-concorrentes-nacionais.csv
        run: |
          python import_csv_concorrentes.py

      - name: âœ… Import completed
        if: success()
        run: |
          echo "Coleta e ImportaÃ§Ã£o concluÃ­das com sucesso."

      - name: âŒ Import failed
        if: failure()
        run: |
          echo "Falha na coleta ou importaÃ§Ã£o."
