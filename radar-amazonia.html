<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DEMAND PULSE AMAZÔNIA — ABR</title>

  <!-- evita warning de favicon -->
  <link rel="icon" href="data:," />

  <!-- fontes -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>

  <!-- SUPABASE (OBRIGATÓRIO antes do JS) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --accent:#00c6ff;
      --bg:#000;
      --panel:rgba(15,18,22,.75);
      --panel-border:rgba(255,255,255,.10);
      --text-main:#eaf3ff;
      --text-dim:#9ca3af;
      --ok:#39ff14;
      --bad:#ff3131;
      --shadow:0 14px 40px rgba(0,0,0,.85)
    }

    *{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none}

    body{
      background:var(--bg);
      color:var(--text-main);
      font-family:'Poppins',sans-serif;
      min-height:100vh;
      overflow-x:hidden
    }

    #matrix-canvas{position:fixed;inset:0;z-index:0;opacity:.30}

    .container{max-width:1600px;margin:0 auto;padding:20px;position:relative;z-index:1}

    header{text-align:center;margin-bottom:22px;padding-top:10px;position:relative}

    .header-nav{position:absolute;top:10px;left:0;display:flex;gap:10px;z-index:10}

    .btn-nav{
      border:1px solid var(--accent);
      padding:8px 16px;
      border-radius:999px;
      font-size:.75rem;
      font-weight:700;
      text-transform:uppercase;
      background:rgba(0,0,0,.75);
      color:var(--accent);
      cursor:pointer;
      text-decoration:none
    }

    .logo{
      width:230px;
      max-width:70vw;
      margin:10px auto 12px;
      display:block;
      filter:drop-shadow(0 0 14px rgba(0,198,255,.28))
    }

    h1{font-size:1.65rem;font-weight:800;letter-spacing:2px;color:var(--accent)}

    .subtitle{color:var(--text-dim);font-size:.95rem;max-width:860px;margin:6px auto 0;line-height:1.5}

    .panel{
      background:var(--panel);
      border:1px solid var(--panel-border);
      border-radius:24px;
      padding:22px;
      backdrop-filter:blur(16px);
      box-shadow:var(--shadow)
    }

    .bi-section{margin:18px 0}

    .dashboard-grid{display:flex;gap:18px;align-items:flex-start}

    .comparison-section{
      flex:3;
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:14px
    }

    .sidebar{flex:1;position:sticky;top:14px}

    .card{
      border-radius:22px;
      padding:18px;
      background:rgba(12,14,18,.60);
      border:1px solid rgba(255,255,255,.10);
      box-shadow:0 12px 30px rgba(0,0,0,.55)
    }

    .card-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}

    .dest-name{font-weight:800;font-size:.95rem}

    .badge{
      font-family:'Fira Code',monospace;
      font-size:.75rem;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.25)
    }

    .badge.up{color:var(--ok)}
    .badge.down{color:var(--bad)}

    .metric{display:flex;justify-content:space-between;margin-top:6px}
    .metric-label{color:var(--text-dim);font-size:.78rem}
    .metric-value{font-weight:900;font-size:1.1rem;color:var(--accent)}

    footer{margin-top:26px;padding:18px 0;text-align:center;opacity:.55;font-size:.75rem;border-top:1px solid var(--panel-border)}

    @media(max-width:1024px){
      .dashboard-grid{flex-direction:column}
      .comparison-section{grid-template-columns:repeat(2,1fr)}
      .sidebar{position:relative}
    }
    @media(max-width:768px){
      .comparison-section{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
<canvas id="matrix-canvas"></canvas>

<div class="container">
  <header>
    <div class="header-nav">
      <a href="index.html" class="btn-nav">← Voltar HUB</a>
    </div>
    <img src="abr-logo.png" class="logo" alt="ABR Logo">
    <h1>DEMAND PULSE AMAZÔNIA</h1>
    <p class="subtitle">Radar de Inteligência Turística do Pará — 15 destinos monitorados</p>
  </header>

  <section class="panel bi-section">
    <canvas id="biChart" style="width:100%;height:360px"></canvas>
  </section>

  <div class="dashboard-grid">
    <section class="comparison-section" id="cards"></section>
    <aside class="sidebar">
      <section class="panel">
        <strong style="color:#00c6ff">BOLETIM ESTRATÉGICO</strong>
        <pre id="boletim" style="margin-top:10px;font-family:'Fira Code',monospace"></pre>
      </section>
    </aside>
  </div>

  <footer>ABR — Demand Pulse Amazônia</footer>
</div>

<script>
/* ================= MATRIX ================= */
const c=document.getElementById('matrix-canvas'),x=c.getContext('2d');
function rs(){c.width=innerWidth;c.height=innerHeight}rs();onresize=rs;
const cols=Math.floor(c.width/16),drops=Array(cols).fill(1);
setInterval(()=>{
  x.fillStyle='rgba(0,0,0,.08)';x.fillRect(0,0,c.width,c.height);
  x.fillStyle='rgba(0,198,255,.45)';x.font='16px monospace';
  drops.forEach((y,i)=>{
    x.fillText(String.fromCharCode(0x30A0+Math.random()*96),i*16,y*16);
    drops[i]=y*16>c.height&&Math.random()>.975?0:y+1;
  });
},90);

/* ================= SUPABASE ================= */
const supabaseClient = supabase.createClient(
  'https://jeoxnzjmfbgnoqqxz.supabase.co',
  'sb_publishable_3omH8_Hx47S3AlmGOoycpw_Etp5P7Nh'
);

let byDestino={};

async function loadData(){
  const {data,error}=await supabaseClient.from('pulse_amazonia').select('*');
  if(error){console.error(error);return}
  data.forEach(r=>{
    if(!byDestino[r.destino_id])byDestino[r.destino_id]={nome:r.destino_nome,vals:[]};
    byDestino[r.destino_id].vals.push(+r.interesse);
  });
  render();
}

function render(){
  const dests=Object.values(byDestino);
  const ctx=document.getElementById('biChart');
  new Chart(ctx,{
    type:'line',
    data:{
      labels:dests[0].vals.map((_,i)=>i+1),
      datasets:dests.slice(0,5).map((d,i)=>({
        label:d.nome,
        data:d.vals,
        borderColor:['#00c6ff','#39ff14','#ff3131','#ffea00','#ff00ff'][i],
        tension:.3
      }))
    }
  });

  const cards=document.getElementById('cards'),bol=document.getElementById('boletim');
  cards.innerHTML='';bol.textContent='';
  dests.forEach(d=>{
    const v=d.vals,last=v[v.length-1],prev=v[v.length-2]||last,chg=((last-prev)/prev*100)||0;
    cards.innerHTML+=`
      <div class="card">
        <div class="card-top">
          <span class="dest-name">${d.nome}</span>
          <span class="badge ${chg>=0?'up':'down'}">${chg.toFixed(1)}%</span>
        </div>
        <div class="metric"><span class="metric-label">Interesse</span><span class="metric-value">${last}</span></div>
      </div>`;
    bol.textContent+=${d.nome}: ${last} pts\n;
  });
}

document.addEventListener('DOMContentLoaded',loadData);
</script>
</body>
</html>